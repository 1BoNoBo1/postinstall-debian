#!/bin/bash

## ON AJOUTE ICI LES SOURCES
## CHAQUE SOURCE CONTIENT UNE FONCTION QUI EST CALL DANS LE MAIN

## ON DECLARE LE MAIN
function main() {
# Script need curl
if [ $DESKTOP_SESSION == "plasma" ]; then
  pwd=$( kdialog --password "Entrez votre mot de passe SUDO" )
elif  [ $DESKTOP_SESSION == "plasmawayland" ]; then
  pwd=$( kdialog --password "Entrez votre mot de passe SUDO" )
elif  [ $DESKTOP_SESSION == "gnome" ]; then
  pwd=$( zenity --password --text="Entrez votre mot de passe SUDO" )
fi
password=$(echo $pwd)
chmod +x data/*.sh
chmod +x extra/*.sh
chmod +x SECUREBOOT/*.sh
chkroot=$(echo $password | sudo -S whoami)
if [ "$password" = "" ]; then
exit
elif [ "$chkroot" != "root" ]; then
  if [ $DESKTOP_SESSION == "plasma" ]; then
    kdialog --error "Mauvais mot de passe"
  elif  [ $DESKTOP_SESSION == "plasmawayland" ]; then
    kdialog --error "Mauvais mot de passe"
  elif  [ $DESKTOP_SESSION == "gnome" ]; then
    zenity --error --text="Mauvais mot de passe"
  fi
exit
fi
preinstall="echo $password | sudo -S dpkg --add-architecture i386 && \
echo $password | sudo -S apt-add-repository -y contrib > /var/log/$LOGNAME.auto-update.txt 2>&1 && \
echo $password | sudo -S apt-add-repository -y non-free >> /var/log/$LOGNAME.auto-update.txt 2>&1 && \
echo $password | sudo -S apt install yad bash-completion"

$preinstall | yad --progress \
  --pulsate \
  --title "Préparation de l'application" \
  --text="Démarrage en cours..." \
  --width=300 \
  --auto-kill
## ON CALL LA FONCTION CONTENU DANS ./source/menu-gui.sh
echo $password | sudo -S bash -e ./source/menu-gui.sh
}
## EN FIN DE FICHIER ON CALL LE MAIN
main
